<div class="stripe-sync-container">
    <div class="tool-header">
        <h3>Stripe Customer Sync</h3>
        <p class="mat-body-2">
            Automatically sync Stripe customer data with your users.
            Users are matched by email address.
        </p>
    </div>

    <div class="sync-actions">
        <button 
            mat-raised-button 
            color="primary" 
            (click)="syncWithStripe()"
            [disabled]="syncing">
            <mat-icon *ngIf="!syncing">sync</mat-icon>
            <mat-spinner diameter="20" *ngIf="syncing"></mat-spinner>
            <span *ngIf="!syncing">Sync with Stripe</span>
            <span *ngIf="syncing">Syncing...</span>
        </button>
    </div>

    <div class="sync-result" *ngIf="syncResult">
        <h4>Sync Results</h4>
        <div class="result-stats">
            <div class="stat">
                <span class="label">Total Users:</span>
                <span class="value">{{ syncResult.totalUsers }}</span>
            </div>
            <div class="stat">
                <span class="label">Stripe Customers Found:</span>
                <span class="value">{{ syncResult.stripeCustomers }}</span>
            </div>
            <div class="stat success">
                <span class="label">Matched & Updated:</span>
                <span class="value">{{ syncResult.matched }}</span>
            </div>
            <div class="stat" *ngIf="syncResult.unmatched > 0">
                <span class="label">Unmatched:</span>
                <span class="value">{{ syncResult.unmatched }}</span>
            </div>
        </div>

        <div class="updated-users" *ngIf="syncResult.updatedUsers && syncResult.updatedUsers.length > 0">
            <h5>Updated Users:</h5>
            <ul>
                <li *ngFor="let user of syncResult.updatedUsers">
                    <strong>{{ user.email }}</strong> - 
                    Customer ID: {{ user.stripeCustomerId }}
                    <span *ngIf="user.subscriptionId"> | Subscription: {{ user.subscriptionId }} ({{ user.subscriptionStatus }})</span>
                </li>
            </ul>
        </div>

        <div class="unmatched-customers" *ngIf="syncResult.unmatchedCustomers && syncResult.unmatchedCustomers.length > 0">
            <h5>Stripe Customers Not Matched:</h5>
            <p class="mat-caption">These Stripe customers don't have matching users in your system:</p>
            <ul>
                <li *ngFor="let customer of syncResult.unmatchedCustomers">
                    {{ customer.email }} ({{ customer.id }})
                </li>
            </ul>
        </div>
    </div>
</div>

